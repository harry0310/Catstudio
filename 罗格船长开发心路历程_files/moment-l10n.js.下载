/**
  * Copyright 2014 Evernote Corporation. All rights reserved
  */

define([
  'jquery',
  'moment',
  'webI18nResources',
  'es6'
], function(
  $,
  moment,
  WebI18nResources
) {
  

  var metaLocale = WebI18nResources.getLocale();

  var i18nToMomentLocaleKey = {
    in: 'id', // indonesian*
    ms: 'ms-my', // Malay*
    'pt_BR': 'pt-br', // portuguese (brazil)*
    sh: undefined, // serbian?*
    sr: undefined, // serbian?*
    vi: 'vn', // vietnamese*
    'zh_CN': 'zh-cn', // chinese*
    'zh_CN_evernoteChina': 'zh-cn', // evernoteChinese*
    'zh_TW': 'zh-tw' // chinese (taiwan)*
  };

  metaLocale = i18nToMomentLocaleKey[metaLocale] || metaLocale;

  // 'en' is default, there is no file
  var validMomentLangs = [
    'ar', 'da', 'de', 'es', 'fi', 'fr', ' gl', 'hu', 'id',
    'it', 'ja', 'ko', 'ms-my', 'nl', 'pl', 'pt', 'pt-br', 'ro',
    'ru', 'sv', 'th', 'tr', 'vn', 'zh-cn', 'zh-tw'
  ];

  var equalsMetaLocale = function(validMomentLocale) {
    return validMomentLocale === metaLocale;
  };
  var deferredMoment = $.Deferred();

  if (validMomentLangs.filter(equalsMetaLocale).length) {
    require(['moment-lang/' + metaLocale],
            function() {
              deferredMoment.resolve(moment);
            });
  } else {
    deferredMoment.resolve(moment);
  }

  return deferredMoment.promise();
});
